(function (a) {
    var b, c = this, d = c.document, e = a(d), f = a(c), g = Array.prototype, h = 1.27, i = true, j = 3e4, k = false, l = navigator.userAgent.toLowerCase(), m = c.location.hash.replace(/#\//, ""), n = function () {
    }, o = function () {
        return false
    }, p = function () {
        var a = 3, c = d.createElement("div"), e = c.getElementsByTagName("i");
        do {
            c.innerHTML = "<!--[if gt IE " + ++a + "]><i></i><![endif]-->"
        } while (e[0]);
        return a > 4 ? a : b
    }(), q = function () {
        return{html: d.documentElement, body: d.body, head: d.getElementsByTagName("head")[0], title: d.title}
    }, r = "data ready thumbnail loadstart loadfinish image play pause progress " + "fullscreen_enter fullscreen_exit idle_enter idle_exit rescale " + "lightbox_open lightbox_close lightbox_image", s = function () {
        var b = [];
        a.each(r.split(" "), function (a, c) {
            b.push(c);
            if (/_/.test(c)) {
                b.push(c.replace(/_/g, ""))
            }
        });
        return b
    }(), t = function (b) {
        var c;
        if (typeof b !== "object") {
            return b
        }
        a.each(b, function (d, e) {
            if (/^[a-z]+_/.test(d)) {
                c = "";
                a.each(d.split("_"), function (a, b) {
                    c += a > 0 ? b.substr(0, 1).toUpperCase() + b.substr(1) : b
                });
                b[c] = e;
                delete b[d]
            }
        });
        return b
    }, u = function (b) {
        if (a.inArray(b, s) > -1) {
            return Galleria[b.toUpperCase()]
        }
        return b
    }, v = {youtube: {reg: /https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&(?:amp;)?)*v(?:<[A-Z]+>)?=([0-9a-zA-Z\-\_]+))/i, embed: function (a) {
        return"http://www.youtube.com/embed/" + a
    }, getThumb: function (b, c, d) {
        d = d || n;
        a.getJSON("http://gdata.youtube.com/feeds/api/videos/" + b + "?v=2&alt=json-in-script&callback=?",function (a) {
            try {
                c(a.entry.media$group.media$thumbnail[0].url)
            } catch (b) {
                d()
            }
        }).error(d)
    }}, vimeo: {reg: /https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i, embed: function (a) {
        return"http://player.vimeo.com/video/" + a
    }, getThumb: function (b, c, d) {
        d = d || n;
        a.getJSON("http://vimeo.com/api/v2/video/" + b + ".json?callback=?",function (a) {
            try {
                c(a[0].thumbnail_medium)
            } catch (b) {
                d()
            }
        }).error(d)
    }}, dailymotion: {reg: /https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/, embed: function (a) {
        return"http://www.dailymotion.com/embed/video/" + a
    }, getThumb: function (b, c, d) {
        d = d || n;
        a.getJSON("https://api.dailymotion.com/video/" + b + "?fields=thumbnail_medium_url&callback=?",function (a) {
            try {
                c(a.thumbnail_medium_url)
            } catch (b) {
                d()
            }
        }).error(d)
    }}}, w = function (a) {
        var b;
        for (var c in v) {
            b = a && a.match(v[c].reg);
            if (b && b.length) {
                return{id: b[2], provider: c}
            }
        }
        return false
    }, x = {trunk: {}, add: function (a, b, d, e) {
        a = a || (new Date).getTime();
        e = e || false;
        this.clear(a);
        if (e) {
            var f = b;
            b = function () {
                f();
                x.add(a, b, d)
            }
        }
        this.trunk[a] = c.setTimeout(b, d)
    }, clear: function (a) {
        var b = function (a) {
            c.clearTimeout(this.trunk[a]);
            delete this.trunk[a]
        }, d;
        if (!!a && a in this.trunk) {
            b.call(x, a)
        } else if (typeof a === "undefined") {
            for (d in this.trunk) {
                if (this.trunk.hasOwnProperty(d)) {
                    b.call(x, d)
                }
            }
        }
    }}, y = [], z = [], A = false, B = false, C = [], D = function (b) {
        Galleria.theme = b;
        a.each(C, function (a, b) {
            if (!b._initialized) {
                b._init.call(b)
            }
        })
    }, E = function () {
        return{array: function (a) {
            return g.slice.call(a, 0)
        }, create: function (a, b) {
            b = b || "div";
            var c = d.createElement(b);
            c.className = a;
            return c
        }, getScriptPath: function (b) {
            b = b || a("script:last").attr("src");
            var c = b.split("/");
            if (c.length == 1) {
                return""
            }
            c.pop();
            return c.join("/") + "/"
        }, animate: function () {
            var b = function (a) {
                var b = "transition WebkitTransition MozTransition OTransition".split(" "), d;
                if (c.opera) {
                    return false
                }
                for (d = 0; b[d]; d++) {
                    if (typeof a[b[d]] !== "undefined") {
                        return b[d]
                    }
                }
                return false
            }((d.body || d.documentElement).style);
            var e = {MozTransition: "transitionend", OTransition: "oTransitionEnd", WebkitTransition: "webkitTransitionEnd", transition: "transitionend"}[b];
            var f = {_default: [.25, .1, .25, 1], galleria: [.645, .045, .355, 1], galleriaIn: [.55, .085, .68, .53], galleriaOut: [.25, .46, .45, .94], ease: [.25, 0, .25, 1], linear: [.25, .25, .75, .75], "ease-in": [.42, 0, 1, 1], "ease-out": [0, 0, .58, 1], "ease-in-out": [.42, 0, .58, 1]};
            var g = function (b, c, d) {
                var e = {};
                d = d || "transition";
                a.each("webkit moz ms o".split(" "), function () {
                    e["-" + this + "-" + d] = c
                });
                b.css(e)
            };
            var h = function (a) {
                g(a, "none", "transition");
                if (Galleria.WEBKIT && Galleria.TOUCH) {
                    g(a, "translate3d(0,0,0)", "transform");
                    if (a.data("revert")) {
                        a.css(a.data("revert"));
                        a.data("revert", null)
                    }
                }
            };
            var i, j, k, l, m, o, p;
            return function (d, q, r) {
                r = a.extend({duration: 400, complete: n, stop: false}, r);
                d = a(d);
                if (!r.duration) {
                    d.css(q);
                    r.complete.call(d[0]);
                    return
                }
                if (!b) {
                    d.animate(q, r);
                    return
                }
                if (r.stop) {
                    d.unbind(e);
                    h(d)
                }
                i = false;
                a.each(q, function (a, b) {
                    p = d.css(a);
                    if (E.parseValue(p) != E.parseValue(b)) {
                        i = true
                    }
                    d.css(a, p)
                });
                if (!i) {
                    c.setTimeout(function () {
                        r.complete.call(d[0])
                    }, r.duration);
                    return
                }
                j = [];
                k = r.easing in f ? f[r.easing] : f._default;
                l = " " + r.duration + "ms" + " cubic-bezier(" + k.join(",") + ")";
                c.setTimeout(function (b, c, d, e) {
                    return function () {
                        b.one(c, function (a) {
                            return function () {
                                h(a);
                                r.complete.call(a[0])
                            }
                        }(b));
                        if (Galleria.WEBKIT && Galleria.TOUCH) {
                            m = {};
                            o = [0, 0, 0];
                            a.each(["left", "top"], function (a, c) {
                                if (c in d) {
                                    o[a] = E.parseValue(d[c]) - E.parseValue(b.css(c)) + "px";
                                    m[c] = d[c];
                                    delete d[c]
                                }
                            });
                            if (o[0] || o[1]) {
                                b.data("revert", m);
                                j.push("-webkit-transform" + e);
                                g(b, "translate3d(" + o.join(",") + ")", "transform")
                            }
                        }
                        a.each(d, function (a, b) {
                            j.push(a + e)
                        });
                        g(b, j.join(","));
                        b.css(d)
                    }
                }(d, e, q, l), 2)
            }
        }(), removeAlpha: function (a) {
            if (p < 9 && a) {
                var b = a.style, c = a.currentStyle, d = c && c.filter || b.filter || "";
                if (/alpha/.test(d)) {
                    b.filter = d.replace(/alpha\([^)]*\)/i, "")
                }
            }
        }, forceStyles: function (b, c) {
            b = a(b);
            if (b.attr("style")) {
                b.data("styles", b.attr("style")).removeAttr("style")
            }
            b.css(c)
        }, revertStyles: function () {
            a.each(E.array(arguments), function (b, c) {
                c = a(c);
                c.removeAttr("style");
                c.attr("style", "");
                if (c.data("styles")) {
                    c.attr("style", c.data("styles")).data("styles", null)
                }
            })
        }, moveOut: function (a) {
            E.forceStyles(a, {position: "absolute", left: -1e4})
        }, moveIn: function () {
            E.revertStyles.apply(E, E.array(arguments))
        }, elem: function (b) {
            if (b instanceof a) {
                return{$: b, dom: b[0]}
            } else {
                return{$: a(b), dom: b}
            }
        }, hide: function (a, b, c) {
            c = c || n;
            var d = E.elem(a), e = d.$;
            a = d.dom;
            if (!e.data("opacity")) {
                e.data("opacity", e.css("opacity"))
            }
            var f = {opacity: 0};
            if (b) {
                var g = p < 9 && a ? function () {
                    E.removeAlpha(a);
                    a.style.visibility = "hidden";
                    c.call(a)
                } : c;
                E.animate(a, f, {duration: b, complete: g, stop: true})
            } else {
                if (p < 9 && a) {
                    E.removeAlpha(a);
                    a.style.visibility = "hidden"
                } else {
                    e.css(f)
                }
            }
        }, show: function (a, b, c) {
            c = c || n;
            var d = E.elem(a), e = d.$;
            a = d.dom;
            var f = parseFloat(e.data("opacity")) || 1, g = {opacity: f};
            if (b) {
                if (p < 9) {
                    e.css("opacity", 0);
                    a.style.visibility = "visible"
                }
                var h = p < 9 && a ? function () {
                    if (g.opacity == 1) {
                        E.removeAlpha(a)
                    }
                    c.call(a)
                } : c;
                E.animate(a, g, {duration: b, complete: h, stop: true})
            } else {
                if (p < 9 && g.opacity == 1 && a) {
                    E.removeAlpha(a);
                    a.style.visibility = "visible"
                } else {
                    e.css(g)
                }
            }
        }, optimizeTouch: function () {
            var b, c, d, e, f = {}, g = function (b) {
                b.preventDefault();
                f = a.extend({}, b, true)
            }, h = function () {
                this.evt = f
            }, i = function () {
                this.handler.call(b, this.evt)
            };
            return function (f) {
                a(f).bind("touchend", function (f) {
                    b = f.target;
                    e = true;
                    while (b.parentNode && b != f.currentTarget && e) {
                        c = a(b).data("events");
                        d = a(b).data("fakes");
                        if (c && "click"in c) {
                            e = false;
                            f.preventDefault();
                            a(b).click(g).click();
                            c.click.pop();
                            a.each(c.click, h);
                            a(b).data("fakes", c.click);
                            delete c.click
                        } else if (d) {
                            e = false;
                            f.preventDefault();
                            a.each(d, i)
                        }
                        b = b.parentNode
                    }
                })
            }
        }(), addTimer: function () {
            x.add.apply(x, E.array(arguments));
            return this
        }, clearTimer: function () {
            x.clear.apply(x, E.array(arguments));
            return this
        }, wait: function (b) {
            b = a.extend({until: o, success: n, error: function () {
                Galleria.raise("Could not complete wait function.")
            }, timeout: 3e3}, b);
            var d = E.timestamp(), e, f, g = function () {
                f = E.timestamp();
                e = f - d;
                if (b.until(e)) {
                    b.success();
                    return false
                }
                if (typeof b.timeout == "number" && f >= d + b.timeout) {
                    b.error();
                    return false
                }
                c.setTimeout(g, 10)
            };
            c.setTimeout(g, 10)
        }, toggleQuality: function (a, b) {
            if (p !== 7 && p !== 8 || !a || a.nodeName.toUpperCase() != "IMG") {
                return
            }
            if (typeof b === "undefined") {
                b = a.style.msInterpolationMode === "nearest-neighbor"
            }
            a.style.msInterpolationMode = b ? "bicubic" : "nearest-neighbor"
        }, insertStyleTag: function (a) {
            var b = d.createElement("style");
            q().head.appendChild(b);
            if (b.styleSheet) {
                b.styleSheet.cssText = a
            } else {
                var c = d.createTextNode(a);
                b.appendChild(c)
            }
        }, loadScript: function (b, c) {
            var d = false, e = a("<scr" + "ipt>").attr({src: b, async: true}).get(0);
            e.onload = e.onreadystatechange = function () {
                if (!d && (!this.readyState || this.readyState === "loaded" || this.readyState === "complete")) {
                    d = true;
                    e.onload = e.onreadystatechange = null;
                    if (typeof c === "function") {
                        c.call(this, this)
                    }
                }
            };
            q().head.appendChild(e)
        }, parseValue: function (a) {
            if (typeof a === "number") {
                return a
            } else if (typeof a === "string") {
                var b = a.match(/\-?\d|\./g);
                return b && b.constructor === Array ? b.join("") * 1 : 0
            } else {
                return 0
            }
        }, timestamp: function () {
            return(new Date).getTime()
        }, loadCSS: function (e, f, g) {
            var h, i = false, j, k = function () {
                var a = new Image;
                a.onload = a.onerror = function (b) {
                    a = null;
                    i = true
                };
                a.src = e
            };
            a("link[rel=stylesheet]").each(function () {
                if ((new RegExp(e)).test(this.href)) {
                    h = this;
                    return false
                }
            });
            if (typeof f === "function") {
                g = f;
                f = b
            }
            g = g || n;
            if (h) {
                g.call(h, h);
                return h
            }
            j = d.styleSheets.length;
            if (a("#" + f).length) {
                a("#" + f).attr("href", e);
                j--;
                i = true
            } else {
                h = a("<link>").attr({rel: "stylesheet", href: e, id: f}).get(0);
                c.setTimeout(function () {
                    var b = a('link[rel="stylesheet"], style');
                    if (b.length) {
                        b.get(0).parentNode.insertBefore(h, b[0])
                    } else {
                        q().head.appendChild(h)
                    }
                    if (p) {
                        if (j >= 31) {
                            Galleria.raise("You have reached the browser stylesheet limit (31)", true);
                            return
                        }
                        h.onreadystatechange = function (a) {
                            if (!i && (!this.readyState || this.readyState === "loaded" || this.readyState === "complete")) {
                                i = true
                            }
                        }
                    } else {
                        var f = d.createElement("a"), g = c.location;
                        f.href = e;
                        if (!/file/.test(g.protocol) && g.hostname == f.hostname && g.port == f.port && g.protocol == f.protocol) {
                            a.ajax({url: e, success: function () {
                                i = true
                            }, error: k})
                        } else {
                            k()
                        }
                    }
                }, 10)
            }
            if (typeof g === "function") {
                E.wait({until: function () {
                    return i && d.styleSheets.length > j
                }, success: function () {
                    c.setTimeout(function () {
                        g.call(h, h)
                    }, 100)
                }, error: function () {
                }, timeout: 1e4})
            }
            return h
        }}
    }(), F = function () {
        var b = function (b, c, d, e) {
            var f = this.getOptions("easing"), g = this.getStageWidth(), h = {left: g * (b.rewind ? -1 : 1)}, i = {left: 0};
            if (d) {
                h.opacity = 0;
                i.opacity = 1
            } else {
                h.opacity = 1
            }
            a(b.next).css(h);
            E.animate(b.next, i, {duration: b.speed, complete: function (a) {
                return function () {
                    c();
                    a.css({left: 0})
                }
            }(a(b.next).add(b.prev)), queue: false, easing: f});
            if (e) {
                b.rewind = !b.rewind
            }
            if (b.prev) {
                h = {left: 0};
                i = {left: g * (b.rewind ? 1 : -1)};
                if (d) {
                    h.opacity = 1;
                    i.opacity = 0
                }
                a(b.prev).css(h);
                E.animate(b.prev, i, {duration: b.speed, queue: false, easing: f, complete: function () {
                    a(this).css("opacity", 0)
                }})
            }
        };
        return{fade: function (b, c) {
            a(b.next).css({opacity: 0, left: 0}).show();
            E.animate(b.next, {opacity: 1}, {duration: b.speed, complete: c});
            if (b.prev) {
                a(b.prev).css("opacity", 1).show();
                E.animate(b.prev, {opacity: 0}, {duration: b.speed})
            }
        }, flash: function (b, c) {
            a(b.next).css({opacity: 0, left: 0});
            if (b.prev) {
                E.animate(b.prev, {opacity: 0}, {duration: b.speed / 2, complete: function () {
                    E.animate(b.next, {opacity: 1}, {duration: b.speed, complete: c})
                }})
            } else {
                E.animate(b.next, {opacity: 1}, {duration: b.speed, complete: c})
            }
        }, pulse: function (b, c) {
            if (b.prev) {
                a(b.prev).hide()
            }
            a(b.next).css({opacity: 0, left: 0}).show();
            E.animate(b.next, {opacity: 1}, {duration: b.speed, complete: c})
        }, slide: function (a, c) {
            b.apply(this, E.array(arguments))
        }, fadeslide: function (a, c) {
            b.apply(this, E.array(arguments).concat([true]))
        }, doorslide: function (a, c) {
            b.apply(this, E.array(arguments).concat([false, true]))
        }}
    }();
    Galleria = function () {
        var g = this;
        this._options = {};
        this._playing = false;
        this._playtime = 5e3;
        this._active = null;
        this._queue = {length: 0};
        this._data = [];
        this._dom = {};
        this._thumbnails = [];
        this._layers = [];
        this._initialized = false;
        this._firstrun = false;
        this._stageWidth = 0;
        this._stageHeight = 0;
        this._target = b;
        this._id = parseInt(Math.random() * 1e4, 10);
        var h = "container stage images image-nav image-nav-left image-nav-right " + "info info-text info-title info-description " + "thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right " + "loader counter tooltip", i = "current total";
        a.each(h.split(" "), function (a, b) {
            g._dom[b] = E.create("galleria-" + b)
        });
        a.each(i.split(" "), function (a, b) {
            g._dom[b] = E.create("galleria-" + b, "span")
        });
        var j = this._keyboard = {keys: {UP: 38, DOWN: 40, LEFT: 37, RIGHT: 39, RETURN: 13, ESCAPE: 27, BACKSPACE: 8, SPACE: 32}, map: {}, bound: false, press: function (a) {
            var b = a.keyCode || a.which;
            if (b in j.map && typeof j.map[b] === "function") {
                j.map[b].call(g, a)
            }
        }, attach: function (a) {
            var b, c;
            for (b in a) {
                if (a.hasOwnProperty(b)) {
                    c = b.toUpperCase();
                    if (c in j.keys) {
                        j.map[j.keys[c]] = a[b]
                    } else {
                        j.map[c] = a[b]
                    }
                }
            }
            if (!j.bound) {
                j.bound = true;
                e.bind("keydown", j.press)
            }
        }, detach: function () {
            j.bound = false;
            j.map = {};
            e.unbind("keydown", j.press)
        }};
        var k = this._controls = {0: b, 1: b, active: 0, swap: function () {
            k.active = k.active ? 0 : 1
        }, getActive: function () {
            return k[k.active]
        }, getNext: function () {
            return k[1 - k.active]
        }};
        var l = this._carousel = {next: g.$("thumb-nav-right"), prev: g.$("thumb-nav-left"), width: 0, current: 0, max: 0, hooks: [], update: function () {
            var b = 0, c = 0, d = [0];
            a.each(g._thumbnails, function (e, f) {
                if (f.ready) {
                    b += f.outerWidth || a(f.container).outerWidth(true);
                    d[e + 1] = b;
                    c = Math.max(c, f.outerHeight || a(f.container).outerHeight(true))
                }
            });
            g.$("thumbnails").css({width: b, height: c});
            l.max = b;
            l.hooks = d;
            l.width = g.$("thumbnails-list").width();
            l.setClasses();
            g.$("thumbnails-container").toggleClass("galleria-carousel", b > l.width);
            l.width = g.$("thumbnails-list").width()
        }, bindControls: function () {
            var a;
            l.next.bind("click", function (b) {
                b.preventDefault();
                if (g._options.carouselSteps === "auto") {
                    for (a = l.current; a < l.hooks.length; a++) {
                        if (l.hooks[a] - l.hooks[l.current] > l.width) {
                            l.set(a - 2);
                            break
                        }
                    }
                } else {
                    l.set(l.current + g._options.carouselSteps)
                }
            });
            l.prev.bind("click", function (b) {
                b.preventDefault();
                if (g._options.carouselSteps === "auto") {
                    for (a = l.current; a >= 0; a--) {
                        if (l.hooks[l.current] - l.hooks[a] > l.width) {
                            l.set(a + 2);
                            break
                        } else if (a === 0) {
                            l.set(0);
                            break
                        }
                    }
                } else {
                    l.set(l.current - g._options.carouselSteps)
                }
            })
        }, set: function (a) {
            a = Math.max(a, 0);
            while (l.hooks[a - 1] + l.width >= l.max && a >= 0) {
                a--
            }
            l.current = a;
            l.animate()
        }, getLast: function (a) {
            return(a || l.current) - 1
        }, follow: function (a) {
            if (a === 0 || a === l.hooks.length - 2) {
                l.set(a);
                return
            }
            var b = l.current;
            while (l.hooks[b] - l.hooks[l.current] < l.width && b <= l.hooks.length) {
                b++
            }
            if (a - 1 < l.current) {
                l.set(a - 1)
            } else if (a + 2 > b) {
                l.set(a - b + l.current + 2)
            }
        }, setClasses: function () {
            l.prev.toggleClass("disabled", !l.current);
            l.next.toggleClass("disabled", l.hooks[l.current] + l.width >= l.max)
        }, animate: function (a) {
            l.setClasses();
            var b = l.hooks[l.current] * -1;
            if (isNaN(b)) {
                return
            }
            E.animate(g.get("thumbnails"), {left: b}, {duration: g._options.carouselSpeed, easing: g._options.easing, queue: false})
        }};
        var m = this._tooltip = {initialized: false, open: false, timer: "tooltip" + g._id, swapTimer: "swap" + g._id, init: function () {
            m.initialized = true;
            var a = ".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3" + "opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";
            E.insertStyleTag(a);
            g.$("tooltip").css("opacity", .8);
            E.hide(g.get("tooltip"))
        }, move: function (a) {
            var b = g.getMousePosition(a).x, c = g.getMousePosition(a).y, d = g.$("tooltip"), e = b, f = c, h = d.outerHeight(true) + 1, i = d.outerWidth(true), j = h + 15;
            var k = g.$("container").width() - i - 2, l = g.$("container").height() - h - 2;
            if (!isNaN(e) && !isNaN(f)) {
                e += 10;
                f -= 30;
                e = Math.max(0, Math.min(k, e));
                f = Math.max(0, Math.min(l, f));
                if (c < j) {
                    f = j
                }
                d.css({left: e, top: f})
            }
        }, bind: function (b, c) {
            if (Galleria.TOUCH) {
                return
            }
            if (!m.initialized) {
                m.init()
            }
            var d = function (b, c) {
                m.define(b, c);
                a(b).hover(function () {
                    E.clearTimer(m.swapTimer);
                    g.$("container").unbind("mousemove", m.move).bind("mousemove", m.move).trigger("mousemove");
                    m.show(b);
                    E.addTimer(m.timer, function () {
                        g.$("tooltip").stop().show().animate({opacity: 1});
                        m.open = true
                    }, m.open ? 0 : 500)
                },function () {
                    g.$("container").unbind("mousemove", m.move);
                    E.clearTimer(m.timer);
                    g.$("tooltip").stop().animate({opacity: 0}, 200, function () {
                        g.$("tooltip").hide();
                        E.addTimer(m.swapTimer, function () {
                            m.open = false
                        }, 1e3)
                    })
                }).click(function () {
                    a(this).trigger("mouseout")
                })
            };
            if (typeof c === "string") {
                d(b in g._dom ? g.get(b) : b, c)
            } else {
                a.each(b, function (a, b) {
                    d(g.get(a), b)
                })
            }
        }, show: function (b) {
            b = a(b in g._dom ? g.get(b) : b);
            var d = b.data("tt"), e = function (a) {
                c.setTimeout(function (a) {
                    return function () {
                        m.move(a)
                    }
                }(a), 10);
                b.unbind("mouseup", e)
            };
            d = typeof d === "function" ? d() : d;
            if (!d) {
                return
            }
            g.$("tooltip").html(d.replace(/\s/, " "));
            b.bind("mouseup", e)
        }, define: function (b, c) {
            if (typeof c !== "function") {
                var d = c;
                c = function () {
                    return d
                }
            }
            b = a(b in g._dom ? g.get(b) : b).data("tt", c);
            m.show(b)
        }};
        var o = this._fullscreen = {scrolled: 0, crop: b, transition: b, active: false, keymap: g._keyboard.map, os: {callback: n, support: function () {
            var a = q().html;
            return a.requestFullscreen || a.mozRequestFullScreen || a.webkitRequestFullScreen
        }(), enter: function (a) {
            o.os.callback = a || n;
            var b = q().html;
            if (b.requestFullscreen) {
                b.requestFullscreen()
            } else if (b.mozRequestFullScreen) {
                b.mozRequestFullScreen()
            } else if (b.webkitRequestFullScreen) {
                b.webkitRequestFullScreen()
            }
        }, exit: function (a) {
            o.os.callback = a || n;
            if (d.exitFullscreen) {
                d.exitFullscreen()
            } else if (d.mozCancelFullScreen) {
                d.mozCancelFullScreen()
            } else if (d.webkitCancelFullScreen) {
                d.webkitCancelFullScreen()
            }
        }, listen: function () {
            if (!o.os.support) {
                return
            }
            var a = function () {
                if (d.fullscreen || d.mozFullScreen || d.webkitIsFullScreen) {
                    o._enter(o.os.callback)
                } else {
                    o._exit(o.os.callback)
                }
            };
            d.addEventListener("fullscreenchange", a, false);
            d.addEventListener("mozfullscreenchange", a, false);
            d.addEventListener("webkitfullscreenchange", a, false)
        }}, enter: function (a) {
            if (g._options.trueFullscreen && o.os.support) {
                o.os.enter(a)
            } else {
                o._enter(a)
            }
        }, _enter: function (c) {
            o.active = true;
            E.hide(g.getActiveImage());
            g.$("container").addClass("fullscreen");
            o.scrolled = f.scrollTop();
            E.forceStyles(g.get("container"), {position: "fixed", top: 0, left: 0, width: "100%", height: "100%", zIndex: 1e4});
            var d = {height: "100%", overflow: "hidden", margin: 0, padding: 0}, e = g.getData(), h = g._options;
            E.forceStyles(q().html, d);
            E.forceStyles(q().body, d);
            o.keymap = a.extend({}, g._keyboard.map);
            g.attachKeyboard({escape: g.exitFullscreen, right: g.next, left: g.prev});
            o.crop = h.imageCrop;
            if (h.fullscreenCrop != b) {
                h.imageCrop = h.fullscreenCrop
            }
            if (e && e.big && e.image !== e.big) {
                var i = new Galleria.Picture, j = i.isCached(e.big), k = g.getIndex(), l = g._thumbnails[k];
                g.trigger({type: Galleria.LOADSTART, cached: j, rewind: false, index: k, imageTarget: g.getActiveImage(), thumbTarget: l, galleriaData: e});
                i.load(e.big, function (b) {
                    g._scaleImage(b, {complete: function (b) {
                        g.trigger({type: Galleria.LOADFINISH, cached: j, index: k, rewind: false, imageTarget: b.image, thumbTarget: l});
                        var c = g._controls.getActive().image;
                        if (c) {
                            a(c).width(b.image.width).height(b.image.height).attr("style", a(b.image).attr("style")).attr("src", b.image.src)
                        }
                    }})
                })
            }
            g.rescale(function () {
                E.addTimer(false, function () {
                    E.show(g.getActiveImage());
                    if (typeof c === "function") {
                        c.call(g)
                    }
                }, 100);
                g.trigger(Galleria.FULLSCREEN_ENTER)
            });
            f.resize(function () {
                o.scale()
            })
        }, scale: function () {
            g.rescale()
        }, exit: function (a) {
            if (g._options.trueFullscreen && o.os.support) {
                o.os.exit(a)
            } else {
                o._exit(a)
            }
        }, _exit: function (a) {
            o.active = false;
            E.hide(g.getActiveImage());
            g.$("container").removeClass("fullscreen");
            E.revertStyles(g.get("container"), q().html, q().body);
            c.scrollTo(0, o.scrolled);
            g.detachKeyboard();
            g.attachKeyboard(o.keymap);
            g._options.imageCrop = o.crop;
            var b = g.getData().big, d = g._controls.getActive().image;
            if (!g.getData().iframe && d && b && b == d.src) {
                c.setTimeout(function (a) {
                    return function () {
                        d.src = a
                    }
                }(g.getData().image), 1)
            }
            g.rescale(function () {
                E.addTimer(false, function () {
                    E.show(g.getActiveImage());
                    if (typeof a === "function") {
                        a.call(g)
                    }
                    f.trigger("resize")
                }, 50);
                g.trigger(Galleria.FULLSCREEN_EXIT)
            });
            f.unbind("resize", o.scale)
        }};
        o.os.listen();
        var r = this._idle = {timer: "idle" + g._id, trunk: [], bound: false, add: function (b, c) {
            if (!b) {
                return
            }
            if (!r.bound) {
                r.addEvent()
            }
            b = a(b);
            var d = {}, e;
            for (e in c) {
                if (c.hasOwnProperty(e)) {
                    d[e] = b.css(e)
                }
            }
            b.data("idle", {from: d, to: c, complete: true, busy: false});
            r.addTimer();
            r.trunk.push(b)
        }, remove: function (b) {
            b = jQuery(b);
            a.each(r.trunk, function (a, c) {
                if (c && c.length && !c.not(b).length) {
                    g._idle.show(b);
                    g._idle.trunk.splice(a, 1)
                }
            });
            if (!r.trunk.length) {
                r.removeEvent();
                E.clearTimer(r.timer)
            }
        }, addEvent: function () {
            r.bound = true;
            g.$("container").bind("mousemove click", r.showAll)
        }, removeEvent: function () {
            r.bound = false;
            g.$("container").unbind("mousemove click", r.showAll)
        }, addTimer: function () {
            E.addTimer(r.timer, function () {
                r.hide()
            }, g._options.idleTime)
        }, hide: function () {
            if (!g._options.idleMode || g.getIndex() === false || g.getData().iframe) {
                return
            }
            g.trigger(Galleria.IDLE_ENTER);
            a.each(r.trunk, function (a, b) {
                var c = b.data("idle");
                if (!c) {
                    return
                }
                b.data("idle").complete = false;
                E.animate(b, c.to, {duration: g._options.idleSpeed})
            })
        }, showAll: function () {
            E.clearTimer(r.timer);
            a.each(r.trunk, function (a, b) {
                r.show(b)
            })
        }, show: function (b) {
            var c = b.data("idle");
            if (!c.busy && !c.complete) {
                c.busy = true;
                g.trigger(Galleria.IDLE_EXIT);
                E.clearTimer(r.timer);
                E.animate(b, c.from, {duration: g._options.idleSpeed / 2, complete: function () {
                    a(this).data("idle").busy = false;
                    a(this).data("idle").complete = true
                }})
            }
            r.addTimer()
        }};
        var s = this._lightbox = {width: 0, height: 0, initialized: false, active: null, image: null, elems: {}, keymap: false, topPosition: 0, init: function () {
            g.trigger(Galleria.LIGHTBOX_OPEN);
            if (s.initialized) {
                return
            }
            s.initialized = true;
            var b = document.body.clientWidth + "px";
            var c = document.body.clientHeight + "px";
            if (a.browser.msie && parseInt(a.browser.version) === 6) {
                s.topPosition = s.getPosition()
            } else {
                s.topPosition = "50%"
            }
            var d = this.elems;
            var e = "overlay box content shadow title info close prevholder prev nextholder next counter image", f = {}, h = g._options, i = "", j = "position:absolute;", k = "lightbox-", l = {overlay: "position:fixed;display:none;opacity:" + h.overlayOpacity + ";filter:alpha(opacity=" + h.overlayOpacity * 100 + ");top:0;left:0;width:" + b + ";height:" + c + ";background:" + h.overlayBackground + ";z-index:99990", box: "position:fixed;display:none;width:400px;height:400px;top:" + s.topPosition + ";left:50%;margin-top:-200px;margin-left:-200px;z-index:99991", shadow: j + "background:#000;width:100%;height:100%;", content: j + "background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden", info: j + "bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px", close: j + "top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999", image: j + "top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;", prevholder: j + "width:50%;top:0;bottom:40px;cursor:pointer;", nextholder: j + "width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;", prev: j + "top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif", next: j + "top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000", title: "float:left", counter: "float:right;margin-left:8px;"}, m = function (b) {
                return b.hover(function () {
                    a(this).css("color", "#bbb")
                }, function () {
                    a(this).css("color", "#444")
                })
            }, n = {};
            if (p && p > 7) {
                l.nextholder += "background:#000;filter:alpha(opacity=0);";
                l.prevholder += "background:#000;filter:alpha(opacity=0);"
            }
            a.each(l, function (a, b) {
                i += ".galleria-" + k + a + "{" + b + "}"
            });
            i += ".galleria-" + k + "box.iframe .galleria-" + k + "prevholder," + ".galleria-" + k + "box.iframe .galleria-" + k + "nextholder{" + "width:100px;height:100px;top:50%;margin-top:-70px}";
            E.insertStyleTag(i);
            a.each(e.split(" "), function (a, b) {
                g.addElement("lightbox-" + b);
                f[b] = s.elems[b] = g.get("lightbox-" + b)
            });
            s.image = new Galleria.Picture;
            a.each({box: "shadow content close prevholder nextholder", info: "title counter", content: "info image", prevholder: "prev", nextholder: "next"}, function (b, c) {
                var d = [];
                a.each(c.split(" "), function (a, b) {
                    d.push(k + b)
                });
                n[k + b] = d
            });
            g.append(n);
            a(f.image).append(s.image.container);
            var b = document.body.clientWidth + "px";
            var c = document.body.clientHeight + "px";
            var o = "50%";
            if (a.browser.msie && a.browser.version.indexOf("6.") > -1) {
                var r = '<iframe class="iframe_select" style="width:' + b + "; height:" + c + '" src="javascript:\'\';"></iframe>';
                a(q().body).append(r, f.overlay, f.box)
            } else {
                a(q().body).append(f.overlay, f.box)
            }
            a(q().body).append(f.overlay, f.box);
            E.optimizeTouch(f.box);
            m(a(f.close).bind("click", s.hide).html("&#215;"));
            a.each(["Prev", "Next"], function (b, c) {
                var d = a(f[c.toLowerCase()]).html(/v/.test(c) ? "&#8249; " : " &#8250;"), e = a(f[c.toLowerCase() + "holder"]);
                e.bind("click", function () {
                    s["show" + c]()
                });
                if (p < 8 || Galleria.TOUCH) {
                    d.show();
                    return
                }
                e.hover(function () {
                    d.show()
                }, function (a) {
                    d.stop().fadeOut(200)
                })
            });
            a(f.overlay).bind("click", s.hide);
            if (Galleria.IPAD) {
                g._options.lightboxTransitionSpeed = 0
            }
        }, getPosition: function () {
            var b = 0;
            if (typeof c.innerHeight !== "undefined") {
                b = c.innerHeight
            } else if (typeof document.documentElement !== "undefined" && typeof document.documentElement.clientHeight !== "undefined" && document.documentElement.clientHeight != 0) {
                b = document.documentElement.clientHeight
            } else {
                b = document.getElementsByTagName("body")[0].clientHeight
            }
            return parseInt(a(c).scrollTop() + b / 2) + "px"
        }, rescale: function (b) {
            if (a.browser.msie && parseInt(a.browser.version) === 6) {
                a(s.elems.box).css({top: s.getPosition()})
            }
            var c = Math.min(f.width() - 40, s.width), d = Math.min(f.height() - 60, s.height), e = Math.min(c / s.width, d / s.height), h = Math.round(s.width * e) + 40, i = Math.round(s.height * e) + 60, j = {width: h, height: i, "margin-top": Math.ceil(i / 2) * -1, "margin-left": Math.ceil(h / 2) * -1};
            if (b) {
                a(s.elems.box).css(j)
            } else {
                a(s.elems.box).animate(j, {duration: g._options.lightboxTransitionSpeed, easing: g._options.easing, complete: function () {
                    var b = s.image, c = g._options.lightboxFadeSpeed;
                    g.trigger({type: Galleria.LIGHTBOX_IMAGE, imageTarget: b.image});
                    a(b.container).show();
                    a(b.image).animate({opacity: 1}, c);
                    E.show(s.elems.info, c)
                }})
            }
        }, hide: function () {
            s.image.image = null;
            f.unbind("resize", s.rescale);
            a(s.elems.box).hide();
            E.hide(s.elems.info);
            g.detachKeyboard();
            g.attachKeyboard(s.keymap);
            if (a.browser.msie && a.browser.version.indexOf("6.") > -1) {
                a(".iframe_select").hide()
            }
            s.keymap = false;
            E.hide(s.elems.overlay, 200, function () {
                a(this).hide().css("opacity", g._options.overlayOpacity);
                g.trigger(Galleria.LIGHTBOX_CLOSE)
            })
        }, showNext: function () {
            s.show(g.getNext(s.active))
        }, showPrev: function () {
            s.show(g.getPrev(s.active))
        }, show: function (b) {
            s.active = b = typeof b === "number" ? b : g.getIndex() || 0;
            if (!s.initialized) {
                s.init()
            }
            if (!s.keymap) {
                s.keymap = a.extend({}, g._keyboard.map);
                g.attachKeyboard({escape: s.hide, right: s.showNext, left: s.showPrev})
            }
            f.unbind("resize", s.rescale);
            var d = g.getData(b), e = g.getDataLength(), h = g.getNext(b), i, j, k;
            E.hide(s.elems.info);
            try {
                for (k = g._options.preload; k > 0; k--) {
                    j = new Galleria.Picture;
                    i = g.getData(h);
                    j.preload("big"in i ? i.big : i.image);
                    h = g.getNext(h)
                }
            } catch (l) {
            }
            s.image.isIframe = !!d.iframe;
            a(s.elems.box).toggleClass("iframe", !!d.iframe);
            s.image.load(d.iframe || d.big || d.image, function (g) {
                s.width = g.isIframe ? a(c).width() : g.original.width;
                s.height = g.isIframe ? a(c).height() : g.original.height;
                a(g.image).css({width: g.isIframe ? "100%" : "100.1%", height: g.isIframe ? "100%" : "100.1%", top: 0, zIndex: 99998, opacity: 0, visibility: "visible"});
                s.elems.title.innerHTML = d.title || "";
                s.elems.counter.innerHTML = b + 1 + " / " + e;
                f.resize(s.rescale);
                s.rescale()
            });
            if (a.browser.msie && a.browser.version.indexOf("6.") > -1) {
                a(".iframe_select").show()
            }
            a(s.elems.overlay).show().css("visibility", "visible");
            a(s.elems.box).show()
        }};
        return this
    };
    Galleria.prototype = {constructor: Galleria, init: function (c, d) {
        var e = this;
        d = t(d);
        this._original = {target: c, options: d, data: null};
        this._target = this._dom.target = c.nodeName ? c : a(c).get(0);
        this._original.html = this._target.innerHTML;
        z.push(this);
        if (!this._target) {
            Galleria.raise("Target not found", true);
            return
        }
        this._options = {autoplay: false, carousel: true, carouselFollow: true, carouselSpeed: 400, carouselSteps: "auto", clicknext: false, dailymotion: {foreground: "%23EEEEEE", highlight: "%235BCEC5", background: "%23222222", logo: 0, hideInfos: 1}, dataConfig: function (a) {
            return{}
        }, dataSelector: "img", dataSource: this._target, debug: b, dummy: b, easing: "galleria", extend: function (a) {
        }, fullscreenCrop: b, fullscreenDoubleTap: true, fullscreenTransition: b, height: 0, idleMode: true, idleTime: 3e3, idleSpeed: 200, imageCrop: false, imageMargin: 0, imagePan: false, imagePanSmoothness: 12, imagePosition: "50%", imageTimeout: b, initialTransition: b, keepSource: false, layerFollow: true, lightbox: false, lightboxFadeSpeed: 200, lightboxTransitionSpeed: 200, linkSourceImages: true, maxScaleRatio: b, minScaleRatio: b, overlayOpacity: .85, overlayBackground: "#0b0b0b", pauseOnInteraction: true, popupLinks: false, preload: 2, queue: true, responsive: false, show: 0, showInfo: true, showCounter: true, showImagenav: true, swipe: true, thumbCrop: true, thumbEventType: "click", thumbFit: true, thumbMargin: 0, thumbQuality: "auto", thumbnails: true, touchTransition: b, transition: "fade", transitionInitial: b, transitionSpeed: 400, trueFullscreen: true, useCanvas: false, vimeo: {title: 0, byline: 0, portrait: 0, color: "aaaaaa"}, wait: 5e3, width: "auto", youtube: {modestbranding: 1, autohide: 1, color: "white", hd: 1, rel: 0, showinfo: 0}};
        this._options.initialTransition = this._options.initialTransition || this._options.transitionInitial;
        if (d && d.debug === false) {
            i = false
        }
        if (d && typeof d.imageTimeout === "number") {
            j = d.imageTimeout
        }
        if (d && typeof d.dummy === "string") {
            k = d.dummy
        }
        a(this._target).children().hide();
        if (typeof Galleria.theme === "object") {
            this._init()
        } else {
            C.push(this)
        }
        return this
    }, _init: function () {
        var b = this, e = this._options;
        if (this._initialized) {
            Galleria.raise("Init failed: Gallery instance already initialized.");
            return this
        }
        this._initialized = true;
        if (!Galleria.theme) {
            Galleria.raise("Init failed: No theme found.", true);
            return this
        }
        a.extend(true, e, Galleria.theme.defaults, this._original.options, Galleria.configure.options);
        (function (a) {
            if (!("getContext"in a)) {
                a = null;
                return
            }
            B = B || {elem: a, context: a.getContext("2d"), cache: {}, length: 0}
        })(d.createElement("canvas"));
        this.bind(Galleria.DATA, function () {
            if (Galleria.QUIRK) {
                Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML.")
            }
            this._original.data = this._data;
            this.get("total").innerHTML = this.getDataLength();
            var a = this.$("container");
            var d = {width: 0, height: 0};
            var e = function () {
                return b.$("stage").height()
            };
            E.wait({until: function () {
                d = b._getWH();
                a.width(d.width).height(d.height);
                return e() && d.width && d.height > 50
            }, success: function () {
                b._width = d.width;
                b._height = d.height;
                if (Galleria.WEBKIT) {
                    c.setTimeout(function () {
                        b._run()
                    }, 1)
                } else {
                    b._run()
                }
            }, error: function () {
                if (e()) {
                    Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:" + d.width + "px, height: " + d.height + "px.", true)
                } else {
                    Galleria.raise("Could not extract a stage height from the CSS. Traced height: " + e() + "px.", true)
                }
            }, timeout: typeof this._options.wait == "number" ? this._options.wait : false})
        });
        this.append({"info-text": ["info-title", "info-description"], info: ["info-text"], "image-nav": ["image-nav-right", "image-nav-left"], stage: ["images", "loader", "counter", "image-nav"], "thumbnails-list": ["thumbnails"], "thumbnails-container": ["thumb-nav-left", "thumbnails-list", "thumb-nav-right"], container: ["stage", "thumbnails-container", "info", "tooltip"]});
        E.hide(this.$("counter").append(this.get("current"), d.createTextNode(" / "), this.get("total")));
        this.setCounter("&#8211;");
        E.hide(b.get("tooltip"));
        this.$("container").addClass(Galleria.TOUCH ? "touch" : "notouch");
        a.each(new Array(2), function (c) {
            var d = new Galleria.Picture;
            a(d.container).css({position: "absolute", top: 0, left: 0}).prepend(b._layers[c] = a(E.create("galleria-layer")).css({position: "absolute", top: 0, left: 0, right: 0, bottom: 0, zIndex: 2})[0]);
            b.$("images").append(d.container);
            b._controls[c] = d
        });
        this.$("images").css({position: "relative", top: 0, left: 0, width: "100%", height: "100%"});
        this.$("thumbnails, thumbnails-list").css({overflow: "hidden", position: "relative"});
        this.$("image-nav-right, image-nav-left").bind("click", function (a) {
            if (e.clicknext) {
                a.stopPropagation()
            }
            if (e.pauseOnInteraction) {
                b.pause()
            }
            var c = /right/.test(this.className) ? "next" : "prev";
            b[c]()
        });
        a.each(["info", "counter", "image-nav"], function (a, c) {
            if (e["show" + c.substr(0, 1).toUpperCase() + c.substr(1).replace(/-/, "")] === false) {
                E.moveOut(b.get(c.toLowerCase()))
            }
        });
        this.load();
        if (!e.keepSource && !p) {
            this._target.innerHTML = ""
        }
        if (this.get("errors")) {
            this.appendChild("target", "errors")
        }
        this.appendChild("target", "container");
        if (e.carousel) {
            var g = 0, h = e.show;
            this.bind(Galleria.THUMBNAIL, function () {
                this.updateCarousel();
                if (++g == this.getDataLength() && typeof h == "number" && h > 0) {
                    this._carousel.follow(h)
                }
            })
        }
        if (e.responsive) {
            f.bind("resize", function () {
                if (!b.isFullscreen()) {
                    b.resize()
                }
            })
        }
        if (e.swipe) {
            (function (a) {
                var c = [0, 0], d = [0, 0], e = 30, f = 100, g = false, h = 0, i, j = {start: "touchstart", move: "touchmove", stop: "touchend"}, k = function (a) {
                    return a.originalEvent.touches ? a.originalEvent.touches[0] : a
                }, l = function (a) {
                    if (a.originalEvent.touches && a.originalEvent.touches.length > 1) {
                        return
                    }
                    i = k(a);
                    d = [i.pageX, i.pageY];
                    if (!c[0]) {
                        c = d
                    }
                    if (Math.abs(c[0] - d[0]) > 10) {
                        a.preventDefault()
                    }
                }, m = function (i) {
                    a.unbind(j.move, l);
                    if (i.originalEvent.touches && i.originalEvent.touches.length || g) {
                        g = !g;
                        return
                    }
                    if (E.timestamp() - h < 1e3 && Math.abs(c[0] - d[0]) > e && Math.abs(c[1] - d[1]) < f) {
                        i.preventDefault();
                        b[c[0] > d[0] ? "next" : "prev"]()
                    }
                    c = d = [0, 0]
                };
                a.bind(j.start, function (b) {
                    if (b.originalEvent.touches && b.originalEvent.touches.length > 1) {
                        return
                    }
                    i = k(b);
                    h = E.timestamp();
                    c = d = [i.pageX, i.pageY];
                    a.bind(j.move, l).one(j.stop, m)
                })
            })(b.$("images"));
            if (e.fullscreenDoubleTap) {
                this.$("stage").bind("touchstart", function () {
                    var a, c, d, e, f, g, h = function (a) {
                        return a.originalEvent.touches ? a.originalEvent.touches[0] : a
                    };
                    return function (i) {
                        g = Galleria.utils.timestamp();
                        c = h(i).pageX;
                        d = h(i).pageY;
                        if (g - a < 500 && c - e < 20 && d - f < 20) {
                            b.toggleFullscreen();
                            i.preventDefault();
                            b.$("stage").unbind("touchend", arguments.callee);
                            return
                        }
                        a = g;
                        e = c;
                        f = d
                    }
                }())
            }
        }
        E.optimizeTouch(this.get("container"));
        a.each(Galleria.on.binds, function (a, c) {
            b.bind(c.type, c.callback)
        });
        return this
    }, _getWH: function () {
        var b = this.$("container"), c = this.$("target"), d = this, e = {}, f;
        a.each(["width", "height"], function (a, g) {
            if (d._options[g] && typeof d._options[g] === "number") {
                e[g] = d._options[g]
            } else {
                f = [E.parseValue(b.css(g)), E.parseValue(c.css(g)), b[g](), c[g]()];
                if (!d["_" + g]) {
                    f.splice(f.length, E.parseValue(b.css("min-" + g)), E.parseValue(c.css("min-" + g)))
                }
                e[g] = Math.max.apply(Math, f)
            }
        });
        if (d._options.height && d._options.height < 2) {
            e.height = e.width * d._options.height
        }
        return e
    }, _createThumbnails: function () {
        this.get("total").innerHTML = this.getDataLength();
        var b, e, f, g, h, i, j = this, k = this._options, l = function () {
            var a = j.$("thumbnails").find(".active");
            if (!a.length) {
                return false
            }
            return a.find("img").attr("src")
        }(), m = typeof k.thumbnails === "string" ? k.thumbnails.toLowerCase() : null, n = function (a) {
            return d.defaultView && d.defaultView.getComputedStyle ? d.defaultView.getComputedStyle(f.container, null)[a] : i.css(a)
        }, o = function (b, c, d) {
            return function () {
                a(d).append(b);
                j.trigger({type: Galleria.THUMBNAIL, thumbTarget: b, index: c, galleriaData: j.getData(c)})
            }
        }, p = function (b) {
            if (k.pauseOnInteraction) {
                j.pause()
            }
            var c = a(b.currentTarget).data("index");
            if (j.getIndex() !== c) {
                j.show(c)
            }
            b.preventDefault()
        }, q = function (b) {
            b.scale({width: b.data.width, height: b.data.height, crop: k.thumbCrop, margin: k.thumbMargin, canvas: k.useCanvas, complete: function (b) {
                var c = ["left", "top"], d = ["Width", "Height"], e, f, g = j.getData(b.index), h = g.thumb.split(":");
                a.each(d, function (d, g) {
                    e = g.toLowerCase();
                    if ((k.thumbCrop !== true || k.thumbCrop === e) && k.thumbFit) {
                        f = {};
                        f[e] = b[e];
                        a(b.container).css(f);
                        f = {};
                        f[c[d]] = 0;
                        a(b.image).css(f)
                    }
                    b["outer" + g] = a(b.container)["outer" + g](true)
                });
                E.toggleQuality(b.image, k.thumbQuality === true || k.thumbQuality === "auto" && b.original.width < b.width * 3);
                if (g.iframe && h.length == 2 && h[0]in v) {
                    v[h[0]].getThumb(h[1], function (a) {
                        return function (b) {
                            a.src = b
                        }
                    }(b.image))
                }
                j.trigger({type: Galleria.THUMBNAIL, thumbTarget: b.image, index: b.data.order, galleriaData: j.getData(b.data.order)})
            }})
        };
        this._thumbnails = [];
        this.$("thumbnails").empty();
        for (b = 0; this._data[b]; b++) {
            g = this._data[b];
            if (k.thumbnails === true && (g.thumb || g.image)) {
                f = new Galleria.Picture(b);
                f.index = b;
                e = g.thumb || g.image;
                this.$("thumbnails").append(f.container);
                i = a(f.container);
                f.data = {width: E.parseValue(n("width")), height: E.parseValue(n("height")), order: b};
                if (k.thumbFit && k.thumbCrop !== true) {
                    i.css({width: "auto", height: "auto"})
                } else {
                    i.css({width: f.data.width, height: f.data.height})
                }
                h = e.split(":");
                if (h.length == 2 && h[0]in v) {
                    f.load("data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D", {height: f.data.height, width: f.data.height * 1.25}, q)
                } else {
                    f.load(e, q)
                }
                if (k.preload === "all") {
                    f.preload(g.image)
                }
            } else if (g.iframe || m === "empty" || m === "numbers") {
                f = {container: E.create("galleria-image"), image: E.create("img", "span"), ready: true};
                if (m === "numbers") {
                    a(f.image).text(b + 1)
                }
                if (g.iframe) {
                    a(f.image).addClass("iframe")
                }
                this.$("thumbnails").append(f.container);
                c.setTimeout(o(f.image, b, f.container), 50 + b * 20)
            } else {
                f = {container: null, image: null}
            }
            a(f.container).add(k.keepSource && k.linkSourceImages ? g.original : null).data("index", b).bind(k.thumbEventType, p);
            if (l === e) {
                a(f.container).addClass("active")
            }
            this._thumbnails.push(f)
        }
    }, _run: function () {
        var d = this;
        d._createThumbnails();
        E.wait({timeout: 1e4, until: function () {
            if (Galleria.OPERA) {
                d.$("stage").css("display", "inline-block")
            }
            d._stageWidth = d.$("stage").width();
            d._stageHeight = d.$("stage").height();
            return d._stageWidth && d._stageHeight > 50
        }, success: function () {
            y.push(d);
            E.show(d.get("counter"));
            if (d._options.carousel) {
                d._carousel.bindControls()
            }
            if (d._options.autoplay) {
                d.pause();
                if (typeof d._options.autoplay === "number") {
                    d._playtime = d._options.autoplay
                }
                d.trigger(Galleria.PLAY);
                d._playing = true
            }
            if (d._firstrun) {
                if (typeof d._options.show === "number") {
                    d.show(d._options.show)
                }
                return
            }
            d._firstrun = true;
            if (Galleria.History) {
                Galleria.History.change(function (a) {
                    if (isNaN(a)) {
                        c.history.go(-1)
                    } else {
                        d.show(a, b, true)
                    }
                })
            }
            d.trigger(Galleria.READY);
            Galleria.theme.init.call(d, d._options);
            a.each(Galleria.ready.callbacks, function () {
                this.call(d, d._options)
            });
            d._options.extend.call(d, d._options);
            if (/^[0-9]{1,4}$/.test(m) && Galleria.History) {
                d.show(m, b, true)
            } else if (d._data[d._options.show]) {
                d.show(d._options.show)
            }
        }, error: function () {
        }})
    }, load: function (b, c, d) {
        var e = this;
        this._data = [];
        this._thumbnails = [];
        this.$("thumbnails").empty();
        if (typeof c === "function") {
            d = c;
            c = null
        }
        b = b || this._options.dataSource;
        c = c || this._options.dataSelector;
        d = d || this._options.dataConfig;
        if (/^function Object/.test(b.constructor)) {
            b = [b]
        }
        if (b.constructor === Array) {
            if (this.validate(b)) {
                this._data = b;
                this._parseData().trigger(Galleria.DATA)
            } else {
                Galleria.raise("Load failed: JSON Array not valid.")
            }
            return this
        }
        c += ",.video,.iframe";
        a(b).find(c).each(function (b, c) {
            c = a(c);
            var f = {}, g = c.parent(), h = g.attr("href"), i = g.attr("rel");
            if (h && (c[0].nodeName == "IMG" || c.hasClass("video")) && w(h)) {
                f.video = h
            } else if (h && c.hasClass("iframe")) {
                f.iframe = h
            } else {
                f.image = f.big = h
            }
            if (i) {
                f.big = i
            }
            a.each("big title description link layer".split(" "), function (a, b) {
                if (c.data(b)) {
                    f[b] = c.data(b)
                }
            });
            e._data.push(a.extend({title: c.attr("title") || "", thumb: c.attr("src"), image: c.attr("src"), big: c.attr("src"), description: c.attr("alt") || "", link: c.attr("longdesc"), original: c.get(0)}, f, d(c)))
        });
        if (this.getDataLength()) {
            this._parseData().trigger(Galleria.DATA)
        } else {
            Galleria.raise("Load failed: no data found.")
        }
        return this
    }, _parseData: function () {
        var b = this, c;
        a.each(this._data, function (d, e) {
            c = b._data[d];
            if ("thumb"in e === false) {
                c.thumb = e.image
            }
            if (!"big"in e) {
                c.big = e.image
            }
            if ("video"in e) {
                var f = w(e.video);
                if (f) {
                    c.iframe = v[f.provider].embed(f.id) + function () {
                        if (typeof b._options[f.provider] == "object") {
                            var c = "?", d = [];
                            a.each(b._options[f.provider], function (a, b) {
                                d.push(a + "=" + b)
                            });
                            if (f.provider == "youtube") {
                                d = ["wmode=opaque"].concat(d)
                            }
                            return c + d.join("&")
                        }
                        return""
                    }();
                    delete c.video;
                    if (!("thumb"in c) || !c.thumb) {
                        c.thumb = f.provider + ":" + f.id
                    }
                }
            }
        });
        return this
    }, destroy: function () {
        this.get("target").innerHTML = this._original.html;
        return this
    }, splice: function () {
        var a = this, b = E.array(arguments);
        c.setTimeout(function () {
            g.splice.apply(a._data, b);
            a._parseData()._createThumbnails()
        }, 2);
        return a
    }, push: function () {
        var a = this, b = E.array(arguments);
        c.setTimeout(function () {
            g.push.apply(a._data, b);
            a._parseData()._createThumbnails()
        }, 2);
        return a
    }, _getActive: function () {
        return this._controls.getActive()
    }, validate: function (a) {
        return true
    }, bind: function (a, b) {
        a = u(a);
        this.$("container").bind(a, this.proxy(b));
        return this
    }, unbind: function (a) {
        a = u(a);
        this.$("container").unbind(a);
        return this
    }, trigger: function (b) {
        b = typeof b === "object" ? a.extend(b, {scope: this}) : {type: u(b), scope: this};
        this.$("container").trigger(b);
        return this
    }, addIdleState: function (a, b) {
        this._idle.add.apply(this._idle, E.array(arguments));
        return this
    }, removeIdleState: function (a) {
        this._idle.remove.apply(this._idle, E.array(arguments));
        return this
    }, enterIdleMode: function () {
        this._idle.hide();
        return this
    }, exitIdleMode: function () {
        this._idle.showAll();
        return this
    }, enterFullscreen: function (a) {
        this._fullscreen.enter.apply(this, E.array(arguments));
        return this
    }, exitFullscreen: function (a) {
        this._fullscreen.exit.apply(this, E.array(arguments));
        return this
    }, toggleFullscreen: function (a) {
        this._fullscreen[this.isFullscreen() ? "exit" : "enter"].apply(this, E.array(arguments));
        return this
    }, bindTooltip: function (a, b) {
        this._tooltip.bind.apply(this._tooltip, E.array(arguments));
        return this
    }, defineTooltip: function (a, b) {
        this._tooltip.define.apply(this._tooltip, E.array(arguments));
        return this
    }, refreshTooltip: function (a) {
        this._tooltip.show.apply(this._tooltip, E.array(arguments));
        return this
    }, openLightbox: function () {
        this._lightbox.show.apply(this._lightbox, E.array(arguments));
        return this
    }, closeLightbox: function () {
        this._lightbox.hide.apply(this._lightbox, E.array(arguments));
        return this
    }, getActiveImage: function () {
        return this._getActive().image || b
    }, getActiveThumb: function () {
        return this._thumbnails[this._active].image || b
    }, getMousePosition: function (a) {
        return{x: a.pageX - this.$("container").offset().left, y: a.pageY - this.$("container").offset().top}
    }, addPan: function (b) {
        if (this._options.imageCrop === false) {
            return
        }
        b = a(b || this.getActiveImage());
        var c = this, d = b.width() / 2, e = b.height() / 2, f = parseInt(b.css("left"), 10), g = parseInt(b.css("top"), 10), h = f || 0, i = g || 0, j = 0, k = 0, l = false, m = E.timestamp(), n = 0, o = 0, q = function (a, c, d) {
            if (a > 0) {
                o = Math.round(Math.max(a * -1, Math.min(0, c)));
                if (n !== o) {
                    n = o;
                    if (p === 8) {
                        b.parent()["scroll" + d](o * -1)
                    } else {
                        var e = {};
                        e[d.toLowerCase()] = o;
                        b.css(e)
                    }
                }
            }
        }, r = function (a) {
            if (E.timestamp() - m < 50) {
                return
            }
            l = true;
            d = c.getMousePosition(a).x;
            e = c.getMousePosition(a).y
        }, s = function (a) {
            if (!l) {
                return
            }
            j = b.width() - c._stageWidth;
            k = b.height() - c._stageHeight;
            f = d / c._stageWidth * j * -1;
            g = e / c._stageHeight * k * -1;
            h += (f - h) / c._options.imagePanSmoothness;
            i += (g - i) / c._options.imagePanSmoothness;
            q(k, i, "Top");
            q(j, h, "Left")
        };
        if (p === 8) {
            b.parent().scrollTop(i * -1).scrollLeft(h * -1);
            b.css({top: 0, left: 0})
        }
        this.$("stage").unbind("mousemove", r).bind("mousemove", r);
        E.addTimer("pan" + c._id, s, 50, true);
        return this
    }, proxy: function (a, b) {
        if (typeof a !== "function") {
            return n
        }
        b = b || this;
        return function () {
            return a.apply(b, E.array(arguments))
        }
    }, removePan: function () {
        this.$("stage").unbind("mousemove");
        E.clearTimer("pan" + this._id);
        return this
    }, addElement: function (b) {
        var c = this._dom;
        a.each(E.array(arguments), function (a, b) {
            c[b] = E.create("galleria-" + b)
        });
        return this
    }, attachKeyboard: function (a) {
        this._keyboard.attach.apply(this._keyboard, E.array(arguments));
        return this
    }, detachKeyboard: function () {
        this._keyboard.detach.apply(this._keyboard, E.array(arguments));
        return this
    }, appendChild: function (a, b) {
        this.$(a).append(this.get(b) || b);
        return this
    }, prependChild: function (a, b) {
        this.$(a).prepend(this.get(b) || b);
        return this
    }, remove: function (a) {
        this.$(E.array(arguments).join(",")).remove();
        return this
    }, append: function (a) {
        var b, c;
        for (b in a) {
            if (a.hasOwnProperty(b)) {
                if (a[b].constructor === Array) {
                    for (c = 0; a[b][c]; c++) {
                        this.appendChild(b, a[b][c])
                    }
                } else {
                    this.appendChild(b, a[b])
                }
            }
        }
        return this
    }, _scaleImage: function (b, c) {
        b = b || this._controls.getActive();
        if (!b) {
            return
        }
        var d = this, e, f = function (b) {
            a(b.container).children(":first").css({top: Math.max(0, E.parseValue(b.image.style.top)), left: Math.max(0, E.parseValue(b.image.style.left)), width: E.parseValue(b.image.width), height: E.parseValue(b.image.height)})
        };
        c = a.extend({width: this._stageWidth, height: this._stageHeight, crop: this._options.imageCrop, max: this._options.maxScaleRatio, min: this._options.minScaleRatio, margin: this._options.imageMargin, position: this._options.imagePosition}, c);
        if (this._options.layerFollow && this._options.imageCrop !== true) {
            if (typeof c.complete == "function") {
                e = c.complete;
                c.complete = function () {
                    e.call(b, b);
                    f(b)
                }
            } else {
                c.complete = f
            }
        } else {
            a(b.container).children(":first").css({top: 0, left: 0})
        }
        b.scale(c);
        return this
    }, updateCarousel: function () {
        this._carousel.update();
        return this
    }, resize: function (c, d) {
        if (typeof c == "function") {
            d = c;
            c = b
        }
        c = a.extend({width: 0, height: 0}, c);
        var e = this, f = this.$("container"), g = this._options.responsive == "aspect" && (!c.width || !c.height), h;
        a.each(c, function (a, b) {
            if (!b) {
                f[a]("auto");
                c[a] = e._getWH()[a]
            }
        });
        if (g) {
            h = Math.min(c.width / this._width, c.height / this._height)
        }
        a.each(c, function (a, b) {
            f[a](h ? h * e["_" + a] : b)
        });
        return this.rescale(d)
    }, rescale: function (a, c, d) {
        var e = this;
        if (typeof a === "function") {
            d = a;
            a = b
        }
        var f = function () {
            e._stageWidth = a || e.$("stage").width();
            e._stageHeight = c || e.$("stage").height();
            e._scaleImage();
            if (e._options.carousel) {
                e.updateCarousel()
            }
            e.trigger(Galleria.RESCALE);
            if (typeof d === "function") {
                d.call(e)
            }
        };
        if (Galleria.WEBKIT && !Galleria.TOUCH && !a && !c) {
            E.addTimer(false, f, 10)
        } else {
            f.call(e)
        }
        return this
    }, refreshImage: function () {
        this._scaleImage();
        if (this._options.imagePan) {
            this.addPan()
        }
        return this
    }, show: function (a, b, c) {
        if (a === false || !this._options.queue && this._queue.stalled) {
            return
        }
        a = Math.max(0, Math.min(parseInt(a, 10), this.getDataLength() - 1));
        b = typeof b !== "undefined" ? !!b : a < this.getIndex();
        c = c || false;
        if (!c && Galleria.History) {
            Galleria.History.set(a.toString());
            return
        }
        this._active = a;
        g.push.call(this._queue, {index: a, rewind: b});
        if (!this._queue.stalled) {
            this._show()
        }
        return this
    }, _show: function () {
        var d = this, e = this._queue[0], f = this.getData(e.index);
        if (!f) {
            return
        }
        var h = f.iframe || (this.isFullscreen() && "big"in f ? f.big : f.image), i = this._controls.getActive(), j = this._controls.getNext(), k = j.isCached(h), l = this._thumbnails[e.index], m = function () {
            a(j.image).trigger("mouseup")
        };
        var n = function (b, e, f, h, i) {
            return function () {
                var j;
                d._queue.stalled = false;
                E.toggleQuality(e.image, d._options.imageQuality);
                d._layers[d._controls.active].innerHTML = "";
                a(f.container).css({zIndex: 0, opacity: 0}).show();
                if (f.isIframe) {
                    a(f.container).find("iframe").remove()
                }
                d.$("container").toggleClass("iframe", !!b.iframe);
                a(e.container).css({zIndex: 1, left: 0, top: 0}).show();
                d._controls.swap();
                if (d._options.imagePan) {
                    d.addPan(e.image)
                }
                if (b.link || d._options.lightbox || d._options.clicknext) {
                    a(e.image).css({cursor: "pointer"}).bind("mouseup", function () {
                        if (d._options.clicknext && !Galleria.TOUCH) {
                            if (d._options.pauseOnInteraction) {
                                d.pause()
                            }
                            d.next();
                            return
                        }
                        if (b.link) {
                            if (d._options.popupLinks) {
                                j = c.open(b.link, "_blank")
                            } else {
                                c.location.href = b.link
                            }
                            return
                        }
                        if (d._options.lightbox) {
                            d.openLightbox()
                        }
                    })
                }
                g.shift.call(d._queue);
                if (d._queue.length) {
                    d._show()
                }
                d._playCheck();
                d.trigger({type: Galleria.IMAGE, index: h.index, imageTarget: e.image, thumbTarget: i.image, galleriaData: b})
            }
        }(f, j, i, e, l);
        if (this._options.carousel && this._options.carouselFollow) {
            this._carousel.follow(e.index)
        }
        if (this._options.preload) {
            var o, p, q = this.getNext(), r;
            try {
                for (p = this._options.preload; p > 0; p--) {
                    o = new Galleria.Picture;
                    r = d.getData(q);
                    o.preload(this.isFullscreen() && "big"in r ? r.big : r.image);
                    q = d.getNext(q)
                }
            } catch (s) {
            }
        }
        E.show(j.container);
        j.isIframe = !!f.iframe;
        a(d._thumbnails[e.index].container).addClass("active").siblings(".active").removeClass("active");
        d.trigger({type: Galleria.LOADSTART, cached: k, index: e.index, rewind: e.rewind, imageTarget: j.image, thumbTarget: l.image, galleriaData: f});
        j.load(h, function (c) {
            var g = a(d._layers[1 - d._controls.active]).html(f.layer || "").hide();
            d._scaleImage(c, {complete: function (c) {
                if ("image"in i) {
                    E.toggleQuality(i.image, false)
                }
                E.toggleQuality(c.image, false);
                d._queue.stalled = true;
                d.removePan();
                d.setInfo(e.index);
                d.setCounter(e.index);
                if (f.layer) {
                    g.show();
                    if (f.link || d._options.lightbox || d._options.clicknext) {
                        g.css("cursor", "pointer").unbind("mouseup").mouseup(m)
                    }
                }
                d.trigger({type: Galleria.LOADFINISH, cached: k, index: e.index, rewind: e.rewind, imageTarget: c.image, thumbTarget: d._thumbnails[e.index].image, galleriaData: d.getData(e.index)});
                var h = d._options.transition;
                a.each({initial: i.image === null, touch: Galleria.TOUCH, fullscreen: d.isFullscreen()}, function (a, c) {
                    if (c && d._options[a + "Transition"] !== b) {
                        h = d._options[a + "Transition"];
                        return false
                    }
                });
                if (h in F === false) {
                    n()
                } else {
                    var j = {prev: i.container, next: c.container, rewind: e.rewind, speed: d._options.transitionSpeed || 400};
                    F[h].call(d, j, n)
                }
            }})
        })
    }, getNext: function (a) {
        a = typeof a === "number" ? a : this.getIndex();
        return a === this.getDataLength() - 1 ? 0 : a + 1
    }, getPrev: function (a) {
        a = typeof a === "number" ? a : this.getIndex();
        return a === 0 ? this.getDataLength() - 1 : a - 1
    }, next: function () {
        if (this.getDataLength() > 1) {
            this.show(this.getNext(), false)
        }
        return this
    }, prev: function () {
        if (this.getDataLength() > 1) {
            this.show(this.getPrev(), true)
        }
        return this
    }, get: function (a) {
        return a in this._dom ? this._dom[a] : null
    }, getData: function (a) {
        return a in this._data ? this._data[a] : this._data[this._active]
    }, getDataLength: function () {
        return this._data.length
    }, getIndex: function () {
        return typeof this._active === "number" ? this._active : false
    }, getStageHeight: function () {
        return this._stageHeight
    }, getStageWidth: function () {
        return this._stageWidth
    }, getOptions: function (a) {
        return typeof a === "undefined" ? this._options : this._options[a]
    }, setOptions: function (b, c) {
        if (typeof b === "object") {
            a.extend(this._options, b)
        } else {
            this._options[b] = c
        }
        return this
    }, play: function (a) {
        this._playing = true;
        this._playtime = a || this._playtime;
        this._playCheck();
        this.trigger(Galleria.PLAY);
        return this
    }, pause: function () {
        this._playing = false;
        this.trigger(Galleria.PAUSE);
        return this
    }, playToggle: function (a) {
        return this._playing ? this.pause() : this.play(a)
    }, isPlaying: function () {
        return this._playing
    }, isFullscreen: function () {
        return this._fullscreen.active
    }, _playCheck: function () {
        var a = this, b = 0, c = 20, d = E.timestamp(), e = "play" + this._id;
        if (this._playing) {
            E.clearTimer(e);
            var f = function () {
                b = E.timestamp() - d;
                if (b >= a._playtime && a._playing) {
                    E.clearTimer(e);
                    a.next();
                    return
                }
                if (a._playing) {
                    a.trigger({type: Galleria.PROGRESS, percent: Math.ceil(b / a._playtime * 100), seconds: Math.floor(b / 1e3), milliseconds: b});
                    E.addTimer(e, f, c)
                }
            };
            E.addTimer(e, f, c)
        }
    }, setPlaytime: function (a) {
        this._playtime = a;
        return this
    }, setIndex: function (a) {
        this._active = a;
        return this
    }, setCounter: function (a) {
        if (typeof a === "number") {
            a++
        } else if (typeof a === "undefined") {
            a = this.getIndex() + 1
        }
        this.get("current").innerHTML = a;
        if (p) {
            var b = this.$("counter"), c = b.css("opacity");
            if (parseInt(c, 10) === 1) {
                E.removeAlpha(b[0])
            } else {
                this.$("counter").css("opacity", c)
            }
        }
        return this
    }, setInfo: function (b) {
        var c = this, d = this.getData(b);
        a.each(["title", "description"], function (a, b) {
            var e = c.$("info-" + b);
            if (!!d[b]) {
                e[d[b].length ? "show" : "hide"]().html(d[b])
            } else {
                e.empty().hide()
            }
        });
        return this
    }, hasInfo: function (a) {
        var b = "title description".split(" "), c;
        for (c = 0; b[c]; c++) {
            if (!!this.getData(a)[b[c]]) {
                return true
            }
        }
        return false
    }, jQuery: function (b) {
        var c = this, d = [];
        a.each(b.split(","), function (b, e) {
            e = a.trim(e);
            if (c.get(e)) {
                d.push(e)
            }
        });
        var e = a(c.get(d.shift()));
        a.each(d, function (a, b) {
            e = e.add(c.get(b))
        });
        return e
    }, $: function (a) {
        return this.jQuery.apply(this, E.array(arguments))
    }};
    a.each(s, function (a, b) {
        var c = /_/.test(b) ? b.replace(/_/g, "") : b;
        Galleria[b.toUpperCase()] = "galleria." + c
    });
    a.extend(Galleria, {IE9: p === 9, IE8: p === 8, IE7: p === 7, IE6: p === 6, IE: p, WEBKIT: /webkit/.test(l), CHROME: /chrome/.test(l), SAFARI: /safari/.test(l) && !/chrome/.test(l), QUIRK: p && d.compatMode && d.compatMode === "BackCompat", MAC: /mac/.test(navigator.platform.toLowerCase()), OPERA: !!c.opera, IPHONE: /iphone/.test(l), IPAD: /ipad/.test(l), ANDROID: /android/.test(l), TOUCH: "ontouchstart"in d});
    Galleria.addTheme = function (b) {
        if (!b.name) {
            Galleria.raise("No theme name specified")
        }
        if (typeof b.defaults !== "object") {
            b.defaults = {}
        } else {
            b.defaults = t(b.defaults)
        }
        var c = false, d;
        if (typeof b.css === "string") {
            a("link").each(function (a, e) {
                d = new RegExp(b.css);
                if (d.test(e.href)) {
                    c = true;
                    D(b);
                    return false
                }
            });
            if (!c) {
                a("script").each(function (a, e) {
                    d = new RegExp("galleria\\." + b.name.toLowerCase() + "\\.");
                    if (d.test(e.src)) {
                        c = e.src.replace(/[^\/]*$/, "") + b.css;
                        E.addTimer("css", function () {
                            E.loadCSS(c, "galleria-theme", function () {
                                D(b)
                            })
                        }, 1)
                    }
                })
            }
            if (!c) {
                Galleria.raise("No theme CSS loaded")
            }
        } else {
            D(b)
        }
        return b
    };
    Galleria.loadTheme = function (d, e) {
        var f = false, g = y.length, h = c.setTimeout(function () {
            Galleria.raise("Theme at " + d + " could not load, check theme path.", true)
        }, 5e3);
        Galleria.theme = b;
        E.loadScript(d, function () {
            c.clearTimeout(h);
            if (g) {
                var b = [];
                a.each(Galleria.get(), function (c, d) {
                    var f = a.extend(d._original.options, {data_source: d._data}, e);
                    d.$("container").remove();
                    var g = new Galleria;
                    g._id = d._id;
                    g.init(d._original.target, f);
                    b.push(g)
                });
                y = b
            }
        });
        return Galleria
    };
    Galleria.get = function (a) {
        if (!!z[a]) {
            return z[a]
        } else if (typeof a !== "number") {
            return z
        } else {
            Galleria.raise("Gallery index " + a + " not found")
        }
    };
    Galleria.configure = function (b, c) {
        var d = {};
        if (typeof b == "string" && c) {
            d[b] = c;
            b = d
        } else {
            a.extend(d, b)
        }
        Galleria.configure.options = d;
        a.each(Galleria.get(), function (a, b) {
            b.setOptions(d)
        });
        return Galleria
    };
    Galleria.configure.options = {};
    Galleria.on = function (b, c) {
        if (!b) {
            return
        }
        Galleria.on.binds.push({type: b, callback: c || n});
        a.each(Galleria.get(), function (a, d) {
            d.bind(b, c)
        });
        return Galleria
    };
    Galleria.on.binds = [];
    Galleria.run = function (b, c) {
        a(b || "#galleria").galleria(c);
        return Galleria
    };
    Galleria.addTransition = function (a, b) {
        F[a] = b;
        return Galleria
    };
    Galleria.utils = E;
    Galleria.log = function () {
        if ("console"in c && "log"in c.console) {
            return c.console.log
        } else {
            return function () {
                c.alert(E.array(arguments).join(", "))
            }
        }
    }();
    Galleria.ready = function (b) {
        a.each(y, function (a, c) {
            b.call(c, c._options)
        });
        Galleria.ready.callbacks.push(b);
        return Galleria
    };
    Galleria.ready.callbacks = [];
    Galleria.raise = function (b, c) {
        var d = c ? "Fatal error" : "Error", e = this, f = {color: "#fff", position: "absolute", top: 0, left: 0, zIndex: 1e5}, g = function (b) {
            var e = '<div style="padding:4px;margin:0 0 2px;background:#' + (c ? "811" : "222") + '";>' + (c ? "<strong>" + d + ": </strong>" : "") + b + "</div>";
            a.each(z, function () {
                var a = this.$("errors"), b = this.$("target");
                if (!a.length) {
                    b.css("position", "relative");
                    a = this.addElement("errors").appendChild("target", "errors").$("errors").css(f)
                }
                a.append(e)
            });
            if (!z.length) {
                a("<div>").css(a.extend(f, {position: "fixed"})).append(e).appendTo(q().body)
            }
        };
        if (i) {
            g(b);
            if (c) {
                throw new Error(d + ": " + b)
            }
        } else if (c) {
            if (A) {
                return
            }
            A = true;
            c = false;
            g("Gallery could not load.")
        }
    };
    Galleria.version = h;
    Galleria.requires = function (a, b) {
        b = b || "You need to upgrade Galleria to version " + a + " to use one or more components.";
        if (Galleria.version < a) {
            Galleria.raise(b, true)
        }
        return Galleria
    };
    Galleria.Picture = function (b) {
        this.id = b || null;
        this.image = null;
        this.container = E.create("galleria-image");
        a(this.container).css({overflow: "hidden", position: "relative"});
        this.original = {width: 0, height: 0};
        this.ready = false;
        this.isIframe = false
    };
    Galleria.Picture.prototype = {cache: {}, show: function () {
        E.show(this.image)
    }, hide: function () {
        E.moveOut(this.image)
    }, clear: function () {
        this.image = null
    }, isCached: function (a) {
        return!!this.cache[a]
    }, preload: function (b) {
        a(new Image).load(function (a, b) {
            return function () {
                b[a] = a
            }
        }(b, this.cache)).attr("src", b)
    }, load: function (b, d, e) {
        if (typeof d == "function") {
            e = d;
            d = null
        }
        if (this.isIframe) {
            var f = "if" + (new Date).getTime();
            this.image = a("<iframe>", {src: b, frameborder: 0, id: f, allowfullscreen: true, css: {visibility: "hidden"}})[0];
            a(this.container).find("iframe,img").remove();
            this.container.appendChild(this.image);
            a("#" + f).load(function (b, d) {
                return function () {
                    c.setTimeout(function () {
                        a(b.image).css("visibility", "visible");
                        if (typeof d == "function") {
                            d.call(b, b)
                        }
                    }, 10)
                }
            }(this, e));
            return this.container
        }
        this.image = new Image;
        var g = 0, h = false, i = false, j = a(this.container), l = a(this.image), m = function (b, e, f) {
            return function () {
                var g = function () {
                    a(this).unbind("load");
                    b.original = d || {height: this.height, width: this.width};
                    b.container.appendChild(this);
                    b.cache[f] = f;
                    if (typeof e == "function") {
                        c.setTimeout(function () {
                            e.call(b, b)
                        }, 1)
                    }
                };
                if (!this.width || !this.height) {
                    c.setTimeout(function (b) {
                        return function () {
                            if (b.width && b.height) {
                                g.call(b)
                            } else {
                                if (!i) {
                                    a(new Image).load(m).attr("src", b.src);
                                    i = true
                                } else {
                                    Galleria.raise("Could not extract width/height from image: " + b.src + ". Traced measures: width:" + b.width + "px, height: " + b.height + "px.")
                                }
                            }
                        }
                    }(this), 2)
                } else {
                    g.call(this)
                }
            }
        }(this, e, b);
        j.find("iframe,img").remove();
        l.css("display", "block");
        E.hide(this.image);
        a.each("minWidth minHeight maxWidth maxHeight".split(" "), function (a, b) {
            l.css(b, /min/.test(b) ? "0" : "none")
        });
        if (this.cache[b]) {
            l.load(m).attr("src", b);
            return this.container
        }
        l.load(m).error(function () {
            if (!h) {
                h = true;
                c.setTimeout(function (a, b) {
                    return function () {
                        a.attr("src", b + "?" + E.timestamp())
                    }
                }(a(this), b), 50)
            } else {
                if (k) {
                    a(this).attr("src", k)
                } else {
                    Galleria.raise("Image not found: " + b)
                }
            }
        }).attr("src", b);
        return this.container
    }, scale: function (c) {
        var d = this;
        c = a.extend({width: 0, height: 0, min: b, max: b, margin: 0, complete: n, position: "center", crop: false, canvas: false}, c);
        if (this.isIframe) {
            a(this.image).width(c.width).height(c.height).removeAttr("width").removeAttr("height");
            a(this.container).width(c.width).height(c.height);
            c.complete.call(d, d);
            try {
                if (this.image.contentWindow) {
                    a(this.image.contentWindow).trigger("resize")
                }
            } catch (e) {
            }
            return this.container
        }
        if (!this.image) {
            return this.container
        }
        var f, g, h = a(d.container), i;
        E.wait({until: function () {
            f = c.width || h.width() || E.parseValue(h.css("width"));
            g = c.height || h.height() || E.parseValue(h.css("height"));
            return f && g
        }, success: function () {
            var b = (f - c.margin * 2) / d.original.width, e = (g - c.margin * 2) / d.original.height, h = Math.min(b, e), j = Math.max(b, e), k = {"true": j, width: b, height: e, "false": h, landscape: d.original.width > d.original.height ? j : h, portrait: d.original.width < d.original.height ? j : h}, l = k[c.crop.toString()], m = "";
            if (c.max) {
                l = Math.min(c.max, l)
            }
            if (c.min) {
                l = Math.max(c.min, l)
            }
            a.each(["width", "height"], function (b, c) {
                a(d.image)[c](d[c] = d.image[c] = Math.round(d.original[c] * l))
            });
            a(d.container).width(f).height(g);
            if (c.canvas && B) {
                B.elem.width = d.width;
                B.elem.height = d.height;
                m = d.image.src + ":" + d.width + "x" + d.height;
                d.image.src = B.cache[m] || function (a) {
                    B.context.drawImage(d.image, 0, 0, d.original.width * l, d.original.height * l);
                    try {
                        i = B.elem.toDataURL();
                        B.length += i.length;
                        B.cache[a] = i;
                        return i
                    } catch (b) {
                        return d.image.src
                    }
                }(m)
            }
            var n = {}, o = {}, p = function (b, c, e) {
                var f = 0;
                if (/\%/.test(b)) {
                    var g = parseInt(b, 10) / 100, h = d.image[c] || a(d.image)[c]();
                    f = Math.ceil(h * -1 * g + e * g)
                } else {
                    f = E.parseValue(b)
                }
                return f
            }, q = {top: {top: 0}, left: {left: 0}, right: {left: "100%"}, bottom: {top: "100%"}};
            a.each(c.position.toLowerCase().split(" "), function (a, b) {
                if (b === "center") {
                    b = "50%"
                }
                n[a ? "top" : "left"] = b
            });
            a.each(n, function (b, c) {
                if (q.hasOwnProperty(c)) {
                    a.extend(o, q[c])
                }
            });
            n = n.top ? a.extend(n, o) : o;
            n = a.extend({top: "50%", left: "50%"}, n);
            a(d.image).css({position: "absolute", top: p(n.top, "height", g), left: p(n.left, "width", f)});
            d.show();
            d.ready = true;
            c.complete.call(d, d)
        }, error: function () {
        }, timeout: 1e3});
        return this
    }};
    a.extend(a.easing, {galleria: function (a, b, c, d, e) {
        if ((b /= e / 2) < 1) {
            return d / 2 * b * b * b + c
        }
        return d / 2 * ((b -= 2) * b * b + 2) + c
    }, galleriaIn: function (a, b, c, d, e) {
        return d * (b /= e) * b + c
    }, galleriaOut: function (a, b, c, d, e) {
        return-d * (b /= e) * (b - 2) + c
    }});
    a.fn.galleria = function (b) {
        var d = this.selector;
        if (!a(this).length) {
            a(function () {
                if (a(d).length) {
                    a(d).galleria(b)
                } else {
                    Galleria.utils.wait({until: function () {
                        return a(d).length
                    }, success: function () {
                        a(d).galleria(b)
                    }, error: function () {
                        Galleria.raise('Init failed: Galleria could not find the element "' + d + '".')
                    }, timeout: 5e3})
                }
            });
            return this
        }
        return this.each(function () {
            if (!a.data(this, "galleria")) {
                a.data(this, "galleria", (new Galleria).init(this, b));
                var d = a(c).height()
            }
        })
    }
})(jQuery)